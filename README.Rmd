---
title: "Quantified Self Movement Analysis"
author: "Bjoern W. Steffens"
date: "4 February 2016"
output: html_document
---

<!---
# Rmarkdown intro
http://rmarkdown.rstudio.com
http://rmarkdown.rstudio.com/authoring_basics.html
--->

### *PLACE YOUR INTRO HERE*


This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and
MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

### 1. Preparing and Reading Data

We will be using ggplot2 to plot data and read.csv to load the data during this exercise.

```{r, echo=TRUE}
#
# Load the libraries we are going to use
# and clean out any left-overs in the $env
rm(list=ls())
library(ggplot2)

#
# Read the csv file and transform the date string to a proper date
steps <- read.csv("activity.csv")
steps$date <- as.Date(steps$date,"%Y-%m-%d")
```


### 2. Analysing Number of Steps per Day

Looking at the available data there are missing values that are ignored for now. The code below shows 5 categories in which the days can be group into.

Note: Plots do not contain any missing values. They have all been filtered out prior to the plot command.

```{r, echo=TRUE}
#
# Clean out the NAs
steps <- steps[complete.cases(steps),]

#
# Get the number of steps per day and clean up column names
stepsDay <- as.data.frame(tapply(steps$steps,steps$date,sum))
stepsDay$Day <- row.names(stepsDay)
colnames(stepsDay) <- c("Steps","Day")
#
# Plot the historgram of the step groups.
par(mar=c(10,10,10,10))
hist(stepsDay$Steps, 
     xlab = "Total Number of Steps in Groups
     Example: 5 days with less than 5000 steps", 
     ylab = "Days with Step Ranges", 
     main = "Number of Steps per Day in Groups",
     col = "lightblue")
```

![alt text](https://github.com/bjoernsteffens/reprores_w1/blob/master/reprores1a.png)

```{r, echo=TRUE}
#
# Plot it on the X axis, dont plot legend and turn the x-labels
g <- ggplot(stepsDay, aes(x=Day, y=Steps, fill = 20))
g + geom_bar(stat = "Identity", alpha = 0.9) +
    theme(axis.text.x = element_text(angle = 90, hjust = 0)) +
    theme(panel.background = element_rect(fill = "lightblue")) +
    theme(strip.background = element_rect(fill = "lightblue")) +
    theme(panel.grid.minor = element_blank()) +
    theme(panel.grid.major = element_line(colour = "grey95")) +
    theme(plot.margin=unit(c(2,1,1.5,1.2),"cm")) +
    scale_y_continuous(labels = scales::comma) +
    theme(legend.position="none") +
    theme(axis.text.x = element_text(size=10,margin = margin(0,0,20,0))) +
    ylab("Number of Recorded Step") + 
    theme(axis.text.y = element_text(size=10,margin = margin(0,0,0,10))) +
    ggtitle("Number of Steps Recorded per Day") +
    theme(plot.title = element_text(size = 20,margin = margin(0,0,30,0)))
```

![alt text](https://github.com/bjoernsteffens/reprores_w1/blob/master/reprores1b.png)

### 3. Mean and Median Number of Steps

Rmarkdown displays the text blow fine ( Mean = 10,766.19, Median = 10,765). The Github Readme does however not understand this.

The average number of steps taken per day is `r format(mean(stepsDay$Steps), digits=7, decimal.mark=".", big.mark=",",small.mark="", , small.interval=2)`. This does not factor in the weekday just an overall average of available data.

The median for the steps is `r format(median(stepsDay$Steps), digits=5, big.mark=",",small.mark="")`. This means that half of the days had less steps than the median and the other half had more steps.


### 4. Average Number of Steps per Day over Time


To plot the average number of steps per day over time, we add that value and the median value to the stepsDay data frame. We do not need the median value now but adding it in case we would need it later.


```{r, echo=TRUE}
stepsDay$AvgSteps <- rep(mean(stepsDay$Steps),nrow(stepsDay))
stepsDay$MedSteps <- rep(median(stepsDay$Steps),nrow(stepsDay))

#
# Plot that time series 
g <- ggplot(stepsDay, aes(x=Day, y=AvgSteps, fill = 20))
g + geom_bar(stat = "Identity", alpha = 0.9) +
    theme(axis.text.x = element_text(angle = 90, hjust = 0)) +
    theme(panel.background = element_rect(fill = "lightblue")) +
    theme(strip.background = element_rect(fill = "lightblue")) +
    theme(panel.grid.minor = element_blank()) +
    theme(panel.grid.major = element_line(colour = "grey95")) +
    theme(plot.margin=unit(c(2,1,1.5,1.2),"cm")) +
    scale_y_continuous(labels = scales::comma) +
    theme(legend.position="none") +
    xlab("Steps per Day") +
    theme(axis.text.x = element_text(size=10,margin = margin(0,0,20,0))) +
    ylab("Average Number of Steps") + 
    theme(axis.text.y = element_text(size=10,margin = margin(0,0,0,10))) +
    ggtitle("Average Number of Steps per Day") +
    theme(plot.title = element_text(size = 20,margin = margin(0,0,30,0)))
```

![alt text](https://github.com/bjoernsteffens/reprores_w1/blob/master/reprores1c.png)


### 5. The 5-minute interval that, on average, contains the maximum number of steps

If we take the average of the steps in each interval across the entire data set we see that the interval in between ~800 and ~900 in the morning seems a likely candidate for the most active period during the day.

```{r, echo=TRUE}
#
# Lets grab the average values for the intervals first
# and fix the column names
stepsAvgInt <- as.data.frame(tapply(steps$steps,steps$interval, mean))
stepsAvgInt$Interval <- row.names(stepsAvgInt)
colnames(stepsAvgInt) <- c("Steps","Interval")

#
# Ensure geom_bar does not try and sort the x Axis
stepsAvgInt$Interval <- factor(stepsAvgInt$Interval, levels = stepsAvgInt$Interval)

g <- ggplot(stepsAvgInt, aes(x=Interval, y=Steps, fill = 20))
g + geom_bar(stat = "Identity", alpha = 0.9) + geom_hline(yintercept=100, col = "red") +
    theme(axis.text.x = element_text(angle = 90, hjust = 0)) +
    #theme(axis.ticks.x = element_blank()) +
    #theme(axis.ticks.length = 12) +
    theme(panel.background = element_rect(fill = "lightblue")) +
    theme(strip.background = element_rect(fill = "lightblue")) +
    theme(panel.grid.minor = element_blank()) +
    theme(panel.grid.major = element_line(colour = "grey95")) +
    theme(plot.margin=unit(c(2,1,1.5,1.2),"cm")) +
    scale_y_continuous(labels = scales::comma) +
    theme(legend.position="none") +
    xlab("Daily Intervals") +
    #
    # ticks only at the full hour
    scale_x_discrete(breaks=seq(0,2355,100)) +
    theme(axis.text.x = element_text(size=10,margin = margin(0,0,20,0))) +
    ylab("Number of Steps per Interval") + 
    theme(axis.text.y = element_text(size=10,margin = margin(0,0,0,10))) +
    ggtitle("Average Number of Steps per Interval") +
    theme(plot.title = element_text(size = 20,margin = margin(0,0,30,0)))
```

![alt text](https://github.com/bjoernsteffens/reprores_w1/blob/master/reprores1d.png)

Looking closer at the data in between 0800 and 0900 we see that there are values below 100 steps so I should take a deeper look into that later to get a better specification of the interval.

```{r, echo = TRUE}
#
# visual inspection gives us the time interval between 0800 and 0900 
# in the morning seems to be the most active ones.
stepsMaxInt <- stepsAvgInt[with(stepsAvgInt, stepsAvgInt$Interval %in% seq(800,855,5)),]

#
# lets plot that
g <- ggplot(stepsMaxInt, aes(x=Interval, y=Steps, fill = 20))
g + geom_bar(stat = "Identity", alpha = 0.9) + geom_hline(yintercept=100, col = "red") +
    theme(axis.text.x = element_text(angle = 90, hjust = 0)) +
    #theme(axis.ticks.x = element_blank()) +
    #theme(axis.ticks.length = 12) +
    theme(panel.background = element_rect(fill = "lightblue")) +
    theme(strip.background = element_rect(fill = "lightblue")) +
    theme(panel.grid.minor = element_blank()) +
    theme(panel.grid.major = element_line(colour = "grey95")) +
    theme(plot.margin=unit(c(2,1,1.5,1.2),"cm")) +
    scale_y_continuous(labels = scales::comma) +
    theme(legend.position="none") +
    xlab("Between 800 and 855") +
    #
    # ticks only at the full hour
    theme(axis.text.x = element_text(size=10,margin = margin(0,0,20,0))) +
    ylab("Number of Steps per Interval") + 
    theme(axis.text.y = element_text(size=10,margin = margin(0,0,0,10))) +
    ggtitle("Steps per Interval between 800 and 855") +
    theme(plot.title = element_text(size = 20,margin = margin(0,0,30,0)))

```

![alt text](https://github.com/bjoernsteffens/reprores_w1/blob/master/reprores1e.png)

We leave this insight for now establishing that the maximum average step intervals are approximately around 8:00am and 8:55am. Deeper analysis of the exact intervals to be explored later.


### 6. Code to describe and show a strategy for imputing missing data

### 7. Histogram of the total number of steps taken each day after missing values are imputed

### 8. Panel plot comparing the average number of steps taken per 5-minute interval across weekdays and weekends
